name: Check show_title on server

on:
  workflow_dispatch:
    inputs:
      slug:
        description: 'Slug —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)'
        required: false
        type: string

jobs:
  check:
    name: Check show_title
    runs-on: ubuntu-latest
    steps:
      - name: Check show_title on server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.PROD_SERVER_HOST }}
          username: ${{ secrets.PROD_SERVER_USER }}
          password: ${{ secrets.PROD_SERVER_PASSWORD }}
          port: 22
          timeout: 60s
          debug: false
          script: |
            cd /var/www/temis/backend
            if [ -n "${{ github.event.inputs.slug }}" ]; then
              echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ slug: ${{ github.event.inputs.slug }}"
              sudo -u www-data venv/bin/python manage.py check_show_title --slug "${{ github.event.inputs.slug }}"
            else
              echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã..."
              sudo -u www-data venv/bin/python manage.py check_show_title
            fi

