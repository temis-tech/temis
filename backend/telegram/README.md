# Интеграция с Telegram ботом

## Описание

Интеграция позволяет получать уведомления в Telegram о событиях на сайте:
- При прохождении анкеты
- При новой записи
- При начале отображения приветственного баннера
- При завершении отображения приветственного баннера

## Настройка

### 1. Создание бота

1. Найдите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 2. Настройка в админке Django

1. Перейдите в админку Django
2. Откройте раздел "Настройки Telegram бота"
3. Заполните:
   - **Токен бота** - токен, полученный от @BotFather (по умолчанию уже заполнен)
   - **Активен** - включите бота
   - Настройте уведомления (какие события должны отправлять уведомления)

### 3. Установка webhook

После настройки бота в админке, установите webhook командой:

```bash
python manage.py setup_webhook
```

Или вручную укажите URL:

```bash
python manage.py setup_webhook --url https://your-domain.com/api/telegram/webhook/
```

### 4. Активация бота пользователем

1. Пользователь должен найти вашего бота в Telegram
2. Отправить команду `/start` или `/help`
3. В админке Django появится запись о новом пользователе в разделе "Пользователи Telegram"

### 5. Настройка администраторов

1. Перейдите в раздел "Пользователи Telegram" в админке
2. Найдите пользователя, который должен получать уведомления
3. Отметьте галочку **"Админ"**
4. Сохраните

**Важно:** Только пользователи с отмеченной галочкой "Админ" будут получать уведомления.

## Периодическая проверка баннеров

Для отправки уведомлений о начале/завершении отображения баннеров, добавьте в cron задачу:

```bash
* * * * * cd /path/to/project/backend && source venv/bin/activate && python manage.py check_banners
```

Эта команда будет проверять баннеры каждую минуту и отправлять уведомления при необходимости.

## Структура

- `models.py` - модели для настроек бота и пользователей
- `admin.py` - настройки админки
- `bot.py` - логика работы с Telegram API
- `views.py` - обработчик webhook
- `signals.py` - сигналы для отправки уведомлений
- `urls.py` - URL маршруты
- `management/commands/` - команды для управления ботом

## API

### Webhook URL

`POST /api/telegram/webhook/` - принимает обновления от Telegram

### Management команды

- `python manage.py setup_webhook` - установить webhook
- `python manage.py check_banners` - проверить баннеры и отправить уведомления

