"""
Management команда для импорта контента с сайта
"""
from django.core.management.base import BaseCommand
from content.models import Branch, Service, Specialist, Review, Promotion, Article, Contact


class Command(BaseCommand):
    help = 'Импортирует контент с сайта temis.ooo'

    def handle(self, *args, **options):
        self.stdout.write(self.style.SUCCESS('Начинаю импорт контента...'))

        # Очищаем существующие данные (опционально)
        # Branch.objects.all().delete()
        # Service.objects.all().delete()
        # и т.д.

        # 1. Импорт контактов
        self.import_contacts()

        # 2. Импорт филиалов
        self.import_branches()

        # 3. Импорт услуг
        self.import_services()

        # 4. Импорт специалистов
        self.import_specialists()

        # 5. Импорт отзывов
        self.import_reviews()

        # 6. Импорт акций
        self.import_promotions()

        # 7. Импорт статей
        self.import_articles()

        self.stdout.write(self.style.SUCCESS('Импорт завершен!'))

    def import_contacts(self):
        """Импорт контактной информации"""
        self.stdout.write('Импортирую контакты...')
        
        Contact.objects.all().delete()
        
        contact, created = Contact.objects.get_or_create(
            phone='+7-993-646-27-23',
            defaults={
                'phone_secondary': '+7-995-890-33-41',
                'inn': '246407269938',
                'is_active': True,
            }
        )
        
        if created:
            self.stdout.write(f'  ✓ Создан контакт: {contact.phone}')
        else:
            self.stdout.write(f'  → Контакт уже существует: {contact.phone}')

    def import_branches(self):
        """Импорт филиалов"""
        self.stdout.write('Импортирую филиалы...')
        
        branches_data = [
            {
                'name': 'Филиал м. Удельная',
                'address': 'Санкт-Петербург, Фермское шоссе, 32',
                'metro': 'метро Удельная',
                'phone': '+7-993-646-27-23',
                'order': 1,
            },
            {
                'name': 'Филиал м. Рыбацкое',
                'address': 'Санкт-Петербург, Рыбацкий проспект, 18 к2',
                'metro': 'метро Рыбацкое',
                'phone': '+7-995-890-33-41',
                'order': 2,
            },
        ]

        for branch_data in branches_data:
            branch, created = Branch.objects.get_or_create(
                name=branch_data['name'],
                defaults=branch_data
            )
            if created:
                self.stdout.write(f'  ✓ Создан филиал: {branch.name}')
            else:
                self.stdout.write(f'  → Филиал уже существует: {branch.name}')

    def import_services(self):
        """Импорт услуг"""
        self.stdout.write('Импортирую услуги...')
        
        services_data = [
            {
                'title': 'Индивидуальные занятия',
                'description': 'Профессиональная помощь в развитии речи и коммуникативных навыков. Индивидуальный подход к каждому ребенку. Работаем над развитием речи, коммуникативных навыков, подготовкой к школе. Используем методики, соответствующие возрасту.',
                'short_description': 'Индивидуальные занятия для детей',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 1,
            },
            {
                'title': 'Запуск речи',
                'description': 'Программа запуска речи помогает ребенку произнести первые слова и фразы. Мы создаем среду, где речь возникает естественно, применяя профессиональный подход с помощью мотивации и игры. В работе используем пальчиковые игры для активации речевых центров мозга и артикуляционную гимнастику.',
                'short_description': 'Программа для детей, которые еще не начали говорить',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 2,
            },
            {
                'title': 'Специалист по развитию',
                'description': 'Выявляем речевые, интеллектуальные, поведенческие трудности, определяем уровень развития психических функций. Развиваем внимание, память, логическое мышление. Помогаем осваивать необходимые для школы навыки: счет, чтение письмо. Скорректируем поведение, научим коммуникации. Работаем с детьми имеющими особенности развития: ЗПР, ЗПРР, СДВГ, РАС, УО и другими нарушениями.',
                'short_description': 'Работа с детьми с особенностями развития',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 3,
            },
            {
                'title': 'Развитие коммуникативных навыков',
                'description': 'Развитие коммуникативных навыков помогает ребенку успешно общаться со сверстниками и взрослыми. Учим поддерживать диалог, выражать просьбы, понимать социальные ситуации. Используем ролевые игры, групповые занятия, нейроигры. Особенно важно для детей с РАС и задержкой развития.',
                'short_description': 'Развитие навыков общения и взаимодействия',
                'price': 2400,
                'duration': '45 минут',
                'order': 4,
            },
            {
                'title': 'Постановка звука [Р]',
                'description': 'Поможем вашему ребенку заговорить чисто и уверенно. С помощью техник звукопостановки мы увлекательно учим правильно произносить сложные звуки. Учитываем индивидуальные особенности каждого ученика. Всё проходит в игровой форме, а когда звук появится мы автоматизируем его с помощью интересных нейроупражнений, для активного закрепления звука в свободной речи ребенка.',
                'short_description': 'Специализированная программа постановки звука Р',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 5,
            },
            {
                'title': 'Детский логопед',
                'description': 'Наш детский логопед помогает решить проблемы речи в игровом формате. Специалист найдет подход даже к самому скромному малышу. Мы работаем над постановкой звуков, развитием коммуникативных навыков, подготовкой к школе. Используем методики, соответствующие возрасту: артикуляционная гимнастика, пальчиковые игры.',
                'short_description': 'Комплексная помощь детского логопеда',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 6,
            },
            {
                'title': 'Коррекция дисграфии',
                'description': 'Ребенок постоянно пропускает или путает буквы, пишет их зеркально, не использует правила и делает «глупые» ошибки. Определим вид дисграфии и устраним её причину. Ключевая роль отводится развитию фонематического слуха. В сложных случаях эффективен логофасциальный массаж, улучшающий нейромышечную связь.',
                'short_description': 'Коррекция нарушений письма у детей',
                'price': 2400,
                'price_with_abonement': 2200,
                'duration': '45 минут',
                'order': 7,
            },
        ]

        for service_data in services_data:
            # Ищем по title, так как slug генерируется автоматически
            service, created = Service.objects.get_or_create(
                title=service_data['title'],
                defaults=service_data
            )
            if created:
                self.stdout.write(f'  ✓ Создана услуга: {service.title}')
            else:
                # Обновляем существующую услугу
                for key, value in service_data.items():
                    if key != 'slug':  # Не обновляем slug
                        setattr(service, key, value)
                service.save()
                self.stdout.write(f'  → Обновлена услуга: {service.title}')

    def import_specialists(self):
        """Импорт специалистов"""
        self.stdout.write('Импортирую специалистов...')
        
        # Получаем филиалы для привязки
        branch_udelnaya = Branch.objects.filter(name__icontains='Удельная').first()
        branch_rybatskoe = Branch.objects.filter(name__icontains='Рыбацкое').first()

        specialists_data = [
            {
                'name': 'Вачкова Ирина Владимировна',
                'position': 'Специалист по развитию, Специалист по сенсорной интеграции',
                'bio': '''Коррекция сенсорно-интегративных дисфункций у детей с РАС, СДВГ и ментальными нарушениями.
Применение методов АВА-терапии для формирования навыков (включая академические, социальные, коммуникативные) и коррекции нежелательного поведения.
Разработка индивидуальных программ развития с учётом неврологических особенностей.

Основные направления практической работы:
• Сенсорная интеграция: Диагностика и коррекция нарушений обработки сенсорной информации (тактильная, вестибулярная, проприоцептивная системы). Адаптация среды для детей с гипер-/гипочувствительностью.
• АВА-терапия: Формирование функциональных навыков, обучение чтению и «вопросительной деятельности», развитие альтернативной коммуникации (PECS, жесты), коррекция нежелательного поведения.
• Работа с целевыми группами: Дети с РАС (аутизм), ментальными нарушениями, генетическими синдромами.
• Поддержка семей: Обучение родителей методам АВА и сенсорной интеграции.''',
                'branch': branch_udelnaya,
                'order': 1,
            },
            {
                'name': 'Полякова Василиса Михайловна',
                'position': 'Квалифицированный учитель-логопед',
                'bio': '''Высшее образование: Специалитет по специальности "Логопедия", квалификация "Учитель-логопед" (2015 г.)
Профессиональная переподготовка: "Дошкольное образование" (2016 г., ГАОУ ДПО "ЛОИРО").

Специализация и повышение квалификации:
• Логомассаж: Технологии коррекционно-педагогического воздействия на мышцы лица и артикуляционного аппарата (АНО «Академия ДПО», Курган, 2020 г., 108 ч.)
• Запуск речи у неговорящих детей: Специфика организации и проведения логопедической работы (АНО ДПО «Северо-Западная Академия ДПО», СПб, 2021 г., 108 ч.)
• Участник VIII Городского Логопедического марафона «Познание. Творчество. Развитие» (СПб, 2018 г.)''',
                'branch': branch_udelnaya,
                'order': 2,
            },
            {
                'name': 'Сывороткина Екатерина Михайловна',
                'position': 'Учитель-логопед широкого профиля',
                'bio': '''Ключевая квалификация:
• Профессиональная переподготовка: Учитель-логопед (Институт специальной педагогики и психологии им. Р. Валленберга, Санкт-Петербург, 2023 г.)
• Тьюторское сопровождение детей с РАС и ТМНР (ООО «Учебный центр «Моя Планета», Москва, 2025 г., 72 ч.)
• Дефектология: Дети с интеллектуальной недостаточностью, особенностями коммуникации и интеллекта (Онлайн-стажировка, курсы О.А. Тарасовой, 2025 г.)
• Нейроподход: Применение нейроматематики в коррекционной работе

Специализация и углубленные методики:
• Коррекция звукопроизношения и дикции: Постановка звуков, полная автоматизация, работа над разборчивостью речи у детей, подростков и взрослых
• Артикуляционная гимнастика: Эффективные методики подготовительного этапа
• Работа с различными возрастными группами: от дошкольников до взрослых''',
                'branch': branch_rybatskoe,
                'order': 3,
            },
            {
                'name': 'Некрасова Оксана Вячеславовна',
                'position': 'Дефектолог, Специалист по коррекции речи',
                'bio': '''Основные направления практической работы:
• Коррекция речевых нарушений (дизартрия, алалия, общее недоразвитие речи, нарушения звукопроизношения)
• Развитие фонематического слуха, лексико-грамматического строя речи, связной речи
• Логопедический массаж (классический, зондовый, массаж ложками)
• Миофункциональная коррекция
• Сенсорная интеграция: диагностика и коррекция нарушений обработки тактильной, вестибулярной, проприоцептивной информации
• Поддержка семей: обучение родителей методам домашней коррекции и сенсорной интеграции

Образование:
• Уральский государственный педагогический университет (УрГПУ) — педагог дошкольного образования, 2001 г.
• Уральский государственный педагогический университет (УрГПУ) — учитель-логопед, 2011 г.

Повышение квалификации:
• Семинар-практикум «Клиникоориентированный подход в логопедической практике. Введение в миофункциональную коррекцию», 2025 г.
• Повышение квалификации «Современные технологии коррекции нарушений постановки звуков у детей дошкольного возраста» (144 часа), 2025 г.
• Повышение квалификации «Логопедический массаж. Классический, зондовый и массаж ложками», 2024 г.
• Повышение квалификации «Дизартрия: диагностика и практические приемы коррекции в условиях реализации ФГОС», 2025 г.

Опыт работы:
• Общий педагогический стаж — более 20 лет
• 6 лет — воспитатель в детском саду
• 6 лет — методист в дошкольном учреждении
• С 2017 года — учитель-логопед и владелица частного детского центра''',
                'branch': branch_rybatskoe,
                'order': 4,
            },
        ]

        for specialist_data in specialists_data:
            specialist, created = Specialist.objects.get_or_create(
                name=specialist_data['name'],
                defaults=specialist_data
            )
            if created:
                self.stdout.write(f'  ✓ Создан специалист: {specialist.name}')
            else:
                # Обновляем существующего специалиста
                for key, value in specialist_data.items():
                    setattr(specialist, key, value)
                specialist.save()
                self.stdout.write(f'  → Обновлен специалист: {specialist.name}')

    def import_reviews(self):
        """Импорт отзывов"""
        self.stdout.write('Импортирую отзывы...')
        
        reviews_data = [
            {
                'author_name': 'Мария',
                'text': 'Отличный центр! Ребенок начал говорить после нескольких занятий. Очень благодарны специалистам!',
                'rating': 5,
                'order': 1,
            },
            {
                'author_name': 'Анна',
                'text': 'Профессиональный подход, индивидуальные занятия. Видим прогресс каждый день. Рекомендую!',
                'rating': 5,
                'order': 2,
            },
            {
                'author_name': 'Елена',
                'text': 'Замечательные логопеды, нашли подход к нашему ребенку. Занятия проходят в игровой форме, ребенку нравится.',
                'rating': 5,
                'order': 3,
            },
        ]

        for review_data in reviews_data:
            review, created = Review.objects.get_or_create(
                author_name=review_data['author_name'],
                text=review_data['text'],
                defaults=review_data
            )
            if created:
                self.stdout.write(f'  ✓ Создан отзыв от: {review.author_name}')
            else:
                self.stdout.write(f'  → Отзыв уже существует от: {review.author_name}')

    def import_promotions(self):
        """Импорт акций"""
        self.stdout.write('Импортирую акции...')
        
        promotions_data = [
            {
                'title': 'Акция на занятия с детским логопедом',
                'description': 'Специальное предложение на курс занятий с детским логопедом. Профессиональная помощь логопеда в постановке звуков.',
                'order': 1,
            },
            {
                'title': 'Курс занятий с детским логопедом',
                'description': 'Выгодное предложение на курс занятий. Абонемент от 4 занятий со скидкой.',
                'order': 2,
            },
        ]

        for promotion_data in promotions_data:
            promotion, created = Promotion.objects.get_or_create(
                title=promotion_data['title'],
                defaults=promotion_data
            )
            if created:
                self.stdout.write(f'  ✓ Создана акция: {promotion.title}')
            else:
                for key, value in promotion_data.items():
                    if key != 'slug':
                        setattr(promotion, key, value)
                promotion.save()
                self.stdout.write(f'  → Обновлена акция: {promotion.title}')

    def import_articles(self):
        """Импорт статей"""
        self.stdout.write('Импортирую статьи...')
        
        articles_data = [
            {
                'title': 'Тренировка мозга для развития речи и обучения',
                'short_description': 'Как развивать речь ребенка через специальные упражнения',
                'content': '''
                    <h2>Тренировка мозга для развития речи</h2>
                    <p>Развитие речи у детей - это комплексный процесс, который требует внимания к различным аспектам развития мозга. В нашем центре мы используем специальные методики для тренировки мозга.</p>
                    <h3>Нейроигры</h3>
                    <p>Нейроигры помогают активировать речевые центры мозга и улучшить координацию движений. Эти упражнения особенно эффективны для детей с задержкой речевого развития.</p>
                    <h3>Артикуляционная гимнастика</h3>
                    <p>Регулярные упражнения для языка, губ и челюсти помогают развить правильное произношение звуков.</p>
                ''',
            },
            {
                'title': 'Формирование правильного произношения у детей',
                'short_description': 'Как помочь ребенку научиться правильно произносить звуки',
                'content': '''
                    <h2>Формирование правильного произношения</h2>
                    <p>Правильное произношение звуков - основа чистой речи. Наши специалисты используют проверенные методики для постановки звуков.</p>
                    <h3>Этапы работы</h3>
                    <ul>
                        <li>Диагностика речевых нарушений</li>
                        <li>Постановка звуков</li>
                        <li>Автоматизация в речи</li>
                        <li>Закрепление навыков</li>
                    </ul>
                    <p>Каждый этап требует индивидуального подхода и терпения.</p>
                ''',
            },
        ]

        for article_data in articles_data:
            article, created = Article.objects.get_or_create(
                title=article_data['title'],
                defaults=article_data
            )
            if created:
                self.stdout.write(f'  ✓ Создана статья: {article.title}')
            else:
                for key, value in article_data.items():
                    if key != 'slug':
                        setattr(article, key, value)
                article.save()
                self.stdout.write(f'  → Обновлена статья: {article.title}')

