"""
Команда для импорта настроек сайта
"""
from django.core.management.base import BaseCommand
from content.models import MenuItem, HeaderSettings, HeroSettings, FooterSettings, PrivacyPolicy


class Command(BaseCommand):
    help = 'Импортирует настройки сайта (меню, шапка, подвал, политика конфиденциальности)'

    def handle(self, *args, **options):
        self.stdout.write(self.style.SUCCESS('Начинаю импорт настроек...'))

        # 1. Импорт меню
        self.import_menu()

        # 2. Импорт настроек шапки
        self.import_header_settings()

        # 3. Импорт настроек Hero
        self.import_hero_settings()

        # 4. Импорт настроек подвала
        self.import_footer_settings()

        # 5. Импорт политики конфиденциальности
        self.import_privacy_policy()

        self.stdout.write(self.style.SUCCESS('Импорт настроек завершен!'))

    def import_menu(self):
        """Импорт пунктов меню"""
        self.stdout.write('Импортирую меню...')
        
        MenuItem.objects.all().delete()
        
        menu_items = [
            {'title': 'Услуги', 'url': '/services', 'order': 1},
            {'title': 'Логопеды', 'url': '/specialists', 'order': 2},
            {'title': 'Отзывы', 'url': '/reviews', 'order': 3},
            {'title': 'Филиалы', 'url': '/branches', 'order': 4},
            {'title': 'Акции', 'url': '/promotions', 'order': 5},
            {'title': 'Статьи', 'url': '/articles', 'order': 6},
            {'title': 'Контакты', 'url': '/contacts', 'order': 7},
        ]

        for item_data in menu_items:
            item, created = MenuItem.objects.get_or_create(
                title=item_data['title'],
                defaults=item_data
            )
            if created:
                self.stdout.write(f'  ✓ Создан пункт меню: {item.title}')
            else:
                for key, value in item_data.items():
                    setattr(item, key, value)
                item.save()
                self.stdout.write(f'  → Обновлен пункт меню: {item.title}')

    def import_header_settings(self):
        """Импорт настроек шапки"""
        self.stdout.write('Импортирую настройки шапки...')
        
        settings, created = HeaderSettings.objects.get_or_create(
            pk=1,
            defaults={
                'logo_text': 'Радуга слов',
                'logo_url': '/',
                'show_menu': True,
                'show_phone': False,
            }
        )
        if created:
            self.stdout.write('  ✓ Созданы настройки шапки')
        else:
            self.stdout.write('  → Настройки шапки уже существуют')

    def import_hero_settings(self):
        """Импорт настроек Hero"""
        self.stdout.write('Импортирую настройки Hero...')
        
        settings, created = HeroSettings.objects.get_or_create(
            pk=1,
            defaults={
                'title': 'Temis - занятия с опытным логопедом',
                'subtitle': 'Помогаем детям в запуске речи, постановке звуков, развитии коммуникативных навыков и мелкой моторики. Используем нейроигры, артикуляционную гимнастику чтобы поддержать произношение, внимание и слух.',
                'button_text': 'Записаться к логопеду',
                'button_url': '#contact-form',
                'is_active': True,
            }
        )
        if created:
            self.stdout.write('  ✓ Созданы настройки Hero')
        else:
            self.stdout.write('  → Настройки Hero уже существуют')

    def import_footer_settings(self):
        """Импорт настроек подвала"""
        self.stdout.write('Импортирую настройки подвала...')
        
        settings, created = FooterSettings.objects.get_or_create(
            pk=1,
            defaults={
                'copyright_text': '© 2024. Все права защищены',
                'show_contacts': True,
                'show_navigation': True,
                'show_social': False,
            }
        )
        if created:
            self.stdout.write('  ✓ Созданы настройки подвала')
        else:
            self.stdout.write('  → Настройки подвала уже существуют')

    def import_privacy_policy(self):
        """Импорт политики конфиденциальности"""
        self.stdout.write('Импортирую политику конфиденциальности...')
        
        privacy_text = '''<h2>1. Общие положения</h2>

Настоящая Политика конфиденциальности определяет порядок обработки и защиты персональных данных пользователей сайта temis.ooo (далее — Сайт).

Используя Сайт, Вы соглашаетесь с условиями настоящей Политики конфиденциальности.

<h2>2. Персональные данные</h2>

Под персональными данными понимается любая информация, относящаяся к прямо или косвенно определенному или определяемому физическому лицу (субъекту персональных данных).

Центр собирает следующие персональные данные:
- Имя
- Номер телефона
- Адрес электронной почты (при указании)
- Иные данные, предоставляемые пользователем добровольно

<h2>3. Цели обработки персональных данных</h2>

Центр обрабатывает персональные данные в следующих целях:
- Предоставление информации об услугах Центра
- Обработка заявок на консультацию и запись на занятия
- Связь с пользователями для уточнения деталей и ответа на вопросы
- Улучшение качества предоставляемых услуг
- Информирование о новых услугах и акциях (только с согласия пользователя)

<h2>4. Правовые основания обработки персональных данных</h2>

Обработка персональных данных осуществляется на основании:
- Согласия субъекта персональных данных на обработку его персональных данных
- Федерального закона от 27.07.2006 № 152-ФЗ "О персональных данных"

<h2>5. Способы и сроки обработки персональных данных</h2>

Обработка персональных данных осуществляется с использованием средств автоматизации и без использования таких средств.

Срок обработки персональных данных определяется достижением целей, для которых были собраны персональные данные, если иной срок не предусмотрен договором или действующим законодательством.

<h2>6. Меры по обеспечению безопасности персональных данных</h2>

Центр принимает необходимые правовые, организационные и технические меры для защиты персональных данных от неправомерного доступа, уничтожения, изменения, блокирования, копирования, предоставления, распространения, а также от иных неправомерных действий.

<h2>7. Права субъектов персональных данных</h2>

Субъект персональных данных имеет право:
- Получать информацию, касающуюся обработки его персональных данных
- Требовать уточнения персональных данных, их блокирования или уничтожения
- Отозвать согласие на обработку персональных данных
- Обжаловать действия или бездействие Центра в уполномоченный орган по защите прав субъектов персональных данных или в судебном порядке

<h2>8. Передача персональных данных третьим лицам</h2>

Центр не передает персональные данные третьим лицам, за исключением случаев:
- Получения согласия субъекта персональных данных на совершение таких действий
- Требований законодательства Российской Федерации

<h2>9. Cookies</h2>

Сайт использует файлы cookie для улучшения работы сайта и персонализации пользовательского опыта. Пользователь может отключить использование cookies в настройках браузера.

<h2>10. Изменения в Политике конфиденциальности</h2>

Центр оставляет за собой право вносить изменения в настоящую Политику конфиденциальности. При внесении изменений в актуальной редакции указывается дата последнего обновления.

<h2>11. Контактная информация</h2>

По всем вопросам, связанным с обработкой персональных данных, Вы можете обратиться:
- Телефон: +7-993-646-27-23, +7-995-890-33-41
- Email: (указать при наличии)

ИНН: 246407269938

Дата последнего обновления: 28.11.2024'''
        
        policy, created = PrivacyPolicy.objects.get_or_create(
            pk=1,
            defaults={
                'title': 'Политика конфиденциальности',
                'content': privacy_text,
                'is_published': True,
            }
        )
        if created:
            self.stdout.write('  ✓ Создана политика конфиденциальности')
        else:
            policy.content = privacy_text
            policy.save()
            self.stdout.write('  → Обновлена политика конфиденциальности')

