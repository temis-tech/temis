#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è SSH –∫–ª—é—á–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/copy-ssh-key.sh [–ø—É—Ç—å_–∫_–∫–ª—é—á—É]

set -e

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

if [ -n "$1" ]; then
    KEY_PATH="$1"
else
    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–ª—é—á
    if [ -f ~/.ssh/id_rsa.pub ]; then
        KEY_PATH=~/.ssh/id_rsa.pub
    elif [ -f ~/.ssh/id_ed25519.pub ]; then
        KEY_PATH=~/.ssh/id_ed25519.pub
    else
        echo "‚ùå SSH –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω"
        echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:"
        ls -1 ~/.ssh/*.pub 2>/dev/null || echo "–ù–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π"
        exit 1
    fi
fi

if [ ! -f "$KEY_PATH" ]; then
    echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $KEY_PATH"
    exit 1
fi

echo -e "${GREEN}üìã –ö–æ–ø–∏—Ä—É—é SSH –∫–ª—é—á: $KEY_PATH${NC}"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
if ! grep -q "^ssh-" "$KEY_PATH"; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ö–ª—é—á –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenSSH"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª—é—á
echo -e "${YELLOW}–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª—é—á–∞:${NC}"
cat "$KEY_PATH"
echo ""

# –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
if command -v pbcopy &> /dev/null; then
    # –£–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ –∏ –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã
    head -1 "$KEY_PATH" | tr -d '\n' | pbcopy
    echo -e "${GREEN}‚úÖ –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!${NC}"
    echo ""
    echo -e "${YELLOW}–¢–µ–ø–µ—Ä—å:${NC}"
    echo "1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ GitHub: https://github.com/settings/keys"
    echo "2. –ù–∞–∂–º–∏ 'New SSH key'"
    echo "3. –í—Å—Ç–∞–≤—å –∫–ª—é—á (Cmd+V) - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –û–î–ù–ê —Å—Ç—Ä–æ–∫–∞"
    echo "4. –î–æ–±–∞–≤—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏"
elif command -v xclip &> /dev/null; then
    head -1 "$KEY_PATH" | tr -d '\n' | xclip -selection clipboard
    echo -e "${GREEN}‚úÖ –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  pbcopy/xclip –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–∫–æ–ø–∏—Ä—É–π –∫–ª—é—á –≤—Ä—É—á–Ω—É—é:${NC}"
    echo ""
    head -1 "$KEY_PATH"
fi

echo ""
echo -e "${YELLOW}–í–∞–∂–Ω–æ:${NC}"
echo "- –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ù–û–ô —Å—Ç—Ä–æ–∫–æ–π (–±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤)"
echo "- –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å 'ssh-rsa' –∏–ª–∏ 'ssh-ed25519'"
echo "- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ –∫–æ–Ω—Ü–µ"

